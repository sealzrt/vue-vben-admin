var Se=Object.defineProperty;var be=Object.getOwnPropertySymbols;var Re=Object.prototype.hasOwnProperty,Ne=Object.prototype.propertyIsEnumerable;var Fe=(n,r,s)=>r in n?Se(n,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[r]=s,L=(n,r)=>{for(var s in r||(r={}))Re.call(r,s)&&Fe(n,s,r[s]);if(be)for(var s of be(r))Ne.call(r,s)&&Fe(n,s,r[s]);return n};var x=(n,r,s)=>new Promise((o,A)=>{var l=c=>{try{w(s.next(c))}catch(h){A(h)}},p=c=>{try{w(s.throw(c))}catch(h){A(h)}},w=c=>c.done?o(c.value):Promise.resolve(c.value).then(l,p);w((s=s.apply(n,r)).next())});import{u as t,g as Ce,c as X,w as Z,am as ke,x as Ae,H as we,h as He,d as Ke,J as Ue,r as Ie,f as z,o as We,Z as ue,a8 as Ve,a9 as oe,l as Te,N as ie,_ as Ye,aa as de,ad as Be,ai as pe,aj as he,F as Xe,ac as De,ak as qe}from"./vue-d56f5f31.js";import{_ as Ge}from"./FormItem.vue_vue_type_script_lang-a47ce972.js";import{b as Je,c as ze,_ as Ze}from"./BasicForm.vue_vue_type_style_index_0_lang-02a2ab57.js";import{h as Me,i as re,d as je,a as Qe}from"./helper-794fc484.js";import{G as W,H as M,I as H,F as et,u as _e,J as Ee,K as me,d as Le,f as tt}from"./entry/index-1163f12d-1703821863576.js";import{e as le,k as ce,s as q,ac as ye,af as Oe,d as Q,v as xe,f as G,a9 as nt,ag as st,ah as at,R as ot,a1 as it}from"./antd-090f1744.js";import{u as rt}from"./index-0ed07fa9.js";function ct(n,r,s){const o=/^\[(.+)\]$/;if(o.test(n)){const A=n.match(o);if(A&&A[1]){const l=A[1].split(",");return r=Array.isArray(r)?r:[r],l.forEach((p,w)=>{q(s,p.trim(),r[w])}),!0}}}function lt(n,r,s){const o=/^\{(.+)\}$/;if(o.test(n)){const A=n.match(o);if(A&&A[1]){const l=A[1].split(",");return r=W(r)?r:{},l.forEach(p=>{q(s,p.trim(),r[p.trim()])}),!0}}}function ft({defaultValueRef:n,getSchema:r,formModel:s,getProps:o}){function A(c){var F,D;if(!W(c))return{};const h={};for(const B of Object.entries(c)){let[,u]=B;const[d]=B;if(!d||M(u)&&u.length===0||le(u))continue;const E=t(o).transformDateFunc;W(u)&&(u=E==null?void 0:E(u)),M(u)&&((F=u[0])!=null&&F.format)&&((D=u[1])!=null&&D.format)&&(u=u.map(y=>E==null?void 0:E(y))),ce(u)&&(u===""?u=void 0:u=u.trim()),!ct(d,u,h)&&!lt(d,u,h)&&q(h,d,u)}return l(h)}function l(c){const h=t(o).fieldMapToTime;if(!h||!Array.isArray(h))return c;for(const[F,[D,B],u="YYYY-MM-DD"]of h){if(!F||!D||!B)continue;if(!ye(c,F)){Oe(c,F);continue}const[d,E]=ye(c,F),[y,b]=Array.isArray(u)?u:[u,u];!Q(d)&&!xe(d)&&q(c,D,p(d,y)),!Q(E)&&!xe(E)&&q(c,B,p(E,b)),Oe(c,F)}return c}function p(c,h){return h==="timestamp"?H(c).unix():h==="timestampStartDay"?H(c).startOf("day").unix():H(c).format(h)}function w(){const c=t(r),h={};c.forEach(F=>{const{defaultValue:D,defaultValueObj:B}=F,u=Object.keys(B||{});u.length&&u.map(d=>{h[d]=B[d],s[d]===void 0&&(s[d]=B[d])}),Q(D)||(h[F.field]=D,s[F.field]===void 0&&(s[F.field]=D))}),n.value=G(h)}return{handleFormValues:A,initDefault:w}}const Y=24;function ut({advanceState:n,emit:r,getProps:s,getSchema:o,formModel:A,defaultValueRef:l}){const p=Ce(),{realWidthRef:w,screenEnum:c,screenRef:h}=et(),F=X(()=>{if(!n.isAdvanced)return 0;const y=t(s).emptySpan||0;if(nt(y))return y;if(W(y)){const{span:b=0}=y,j=t(h);return y[j.toLowerCase()]||b||0}return 0}),D=_e(d,30);Z([()=>t(o),()=>n.isAdvanced,()=>t(w)],()=>{const{showAdvancedButton:y}=t(s);y&&D()},{immediate:!0});function B(y,b=0,j=!1){const P=t(w),C=parseInt(y.md)||parseInt(y.xs)||parseInt(y.sm)||y.span||Y,$=parseInt(y.lg)||C,N=parseInt(y.xl)||$,S=parseInt(y.xxl)||N;return P<=c.LG?b+=C:P<c.XL?b+=$:P<c.XXL?b+=N:b+=S,j?(n.hideAdvanceBtn=!1,b<=Y*2?(n.hideAdvanceBtn=!0,n.isAdvanced=!0):b>Y*2&&b<=Y*(t(s).autoAdvancedLine||3)?n.hideAdvanceBtn=!1:n.isLoad||(n.isLoad=!0,n.isAdvanced=!n.isAdvanced),{isAdvanced:n.isAdvanced,itemColSum:b}):b>Y*(t(s).alwaysShowLines||1)?{isAdvanced:n.isAdvanced,itemColSum:b}:{isAdvanced:!0,itemColSum:b}}const u=ke({});function d(){var P;let y=0,b=0;const{baseColProps:j={}}=t(s);for(const C of t(o)){const{show:$,colProps:N}=C;let S=!0;if(st($)&&(S=$),le($)&&(S=$({schema:C,model:A,field:C.field,values:L(L({},t(l)),A)})),S&&(N||j)){const{itemColSum:K,isAdvanced:J}=B(L(L({},j),N),y);y=K||0,J&&(b=y),u[C.field]=J}}(P=p==null?void 0:p.proxy)==null||P.$forceUpdate(),n.actionSpan=b%Y+t(F),B(t(s).actionColOptions||{span:Y},y,!0),r("advanced-change")}function E(){n.isAdvanced=!n.isAdvanced}return{handleToggleAdvanced:E,fieldsIsAdvancedMap:u}}function dt(n,r={}){const s=/^\[(.+)\]$/;if(s.test(n)){const o=n.match(s);if(o&&o[1]){const A=o[1].split(",");if(!A.length)return;const l=[];return A.forEach((p,w)=>{q(l,w,r[p.trim()])}),l.filter(Boolean).length?l:void 0}}}function pt(n,r={}){const s=/^\{(.+)\}$/;if(s.test(n)){const o=n.match(s);if(o&&o[1]){const A=o[1].split(",");if(!A.length)return;const l={};return A.forEach(p=>{q(l,p.trim(),r[p.trim()])}),Object.values(l).filter(Boolean).length?l:void 0}}}function ht({emit:n,getProps:r,formModel:s,getSchema:o,defaultValueRef:A,formElRef:l,schemaRef:p,handleFormValues:w}){function c(){return x(this,null,function*(){const{resetFunc:e,submitOnReset:a}=t(r);e&&le(e)&&(yield e()),t(l)&&(Object.keys(s).forEach(i=>{const g=t(o).find(I=>I.field===i),m=g==null?void 0:g.defaultValueObj,O=Object.keys(m||{});O.length&&O.map(I=>{s[I]=m[I]}),s[i]=mt(g,A,i)}),Ae(()=>N()),n("reset",we(s)),a&&K())})}const h=()=>t(o).map(e=>[...e.fields||[],e.field]).flat(1).filter(Boolean);function F(e){return x(this,null,function*(){if(Object.keys(e).length===0)return;const a=h(),v=".",i=a.filter(m=>String(m).indexOf(v)>=0),g=[];a.forEach(m=>{const O=t(o).find(T=>T.field===m);let I=ye(e,m);const fe=Reflect.has(e,m);I=Me(O==null?void 0:O.component,I);const{componentProps:ee}=O||{};let R=ee;typeof ee=="function"&&(R=R({formModel:t(s),formActionType:J}));const te=dt(m,e)||pt(m,e);if(fe||te){const T=te||I;if(j(m))if(Array.isArray(T)){const U=[];for(const f of T)U.push(f?H(f):null);t(s)[m]=U}else t(s)[m]=T?R!=null&&R.valueFormat?T:H(T):null;else t(s)[m]=T;R!=null&&R.onChange&&(R==null||R.onChange(T)),g.push(m)}else i.forEach(T=>{try{const U=T.split(".").reduce((f,_)=>f[_],e);Ee(U)&&(t(s)[T]=t(U),g.push(T))}catch(U){Ee(A.value[T])&&(t(s)[T]=G(t(A.value[T])))}})}),P(g).catch(m=>{})})}function D(e){return x(this,null,function*(){const a=G(t(o));if(!e)return;let v=ce(e)?[e]:e;ce(e)&&(v=[e]);for(const i of v)B(i,a);p.value=a})}function B(e,a){if(ce(e)){const v=a.findIndex(i=>i.field===e);v!==-1&&(delete s[e],a.splice(v,1))}}function u(e,a,v=!1){return x(this,null,function*(){const i=G(t(o)),g=Array.isArray(e)?e.map(I=>I.field):[e.field];if(i.find(I=>g.includes(I.field))){me("There are schemas that have already been added");return}const m=i.findIndex(I=>I.field===a),O=W(e)?[e]:e;!a||m===-1||v?v?i.unshift(...O):i.push(...O):m!==-1&&i.splice(m+1,0,...O),p.value=i,y(e)})}function d(e){return x(this,null,function*(){let a=[];if(W(e)&&a.push(e),M(e)&&(a=[...e]),!a.every(i=>re(i.component)||Reflect.has(i,"field")&&i.field)){me("All children of the form Schema array that need to be updated must contain the `field` field");return}p.value=a})}function E(e){return x(this,null,function*(){let a=[];if(W(e)&&a.push(e),M(e)&&(a=[...e]),!a.every(m=>re(m.component)||Reflect.has(m,"field")&&m.field)){me("All children of the form Schema array that need to be updated must contain the `field` field");return}const i=[],g=[];t(o).forEach(m=>{const O=a.find(I=>m.field===I.field);if(O){const I=Le(m,O);g.push(I),i.push(I)}else i.push(m)}),y(g),p.value=at(i,"field")})}function y(e){let a=[];W(e)&&a.push(e),M(e)&&(a=[...e]);const v={},i=b();a.forEach(g=>{!re(g.component)&&Reflect.has(g,"field")&&g.field&&!Q(g.defaultValue)&&(!(g.field in i)||Q(i[g.field]))&&(v[g.field]=g.defaultValue)}),F(v)}function b(){return t(l)?w(we(t(s))):{}}function j(e){return t(o).some(a=>a.field===e&&a.component?je.includes(a.component):!1)}function P(e){return x(this,null,function*(){var v;const a=yield(v=t(l))==null?void 0:v.validateFields(e);return w(a)})}function C(e){return x(this,null,function*(){var a;yield(a=t(l))==null?void 0:a.setProps(e)})}function $(e){return x(this,null,function*(){var i;let a;e===void 0?a=h():a=e===Array.isArray(e)?e:void 0;const v=yield(i=t(l))==null?void 0:i.validate(a);return w(v)})}function N(e){return x(this,null,function*(){var a;yield(a=t(l))==null?void 0:a.clearValidate(e)})}function S(e,a){return x(this,null,function*(){var v;yield(v=t(l))==null?void 0:v.scrollToField(e,a)})}function K(e){return x(this,null,function*(){e&&e.preventDefault();const{submitFunc:a}=t(r);if(a&&le(a)){yield a();return}if(t(l))try{const i=yield $();n("submit",i)}catch(i){if((i==null?void 0:i.outOfDate)===!1&&(i!=null&&i.errorFields))return;throw new Error(i)}})}const J={getFieldsValue:b,setFieldsValue:F,resetFields:c,updateSchema:E,resetSchema:d,setProps:C,removeSchemaByField:D,appendSchemaByField:u,clearValidate:N,validateFields:P,validate:$,submit:K,scrollToField:S};return{handleSubmit:K,clearValidate:N,validate:$,validateFields:P,getFieldsValue:b,updateSchema:E,resetSchema:d,appendSchemaByField:u,removeSchemaByField:D,resetFields:c,setFieldsValue:F,scrollToField:S}}function mt(n,r,s){let o=G(r.value[s]);return At(n)?o||"":(!o&&n&&yt(n)&&(o=[0,0]),!o&&n&&n.component==="ApiTree"&&(o=[]),o)}function yt(n){if(n.component==="Slider"&&n.componentProps&&"range"in n.componentProps)return!0}function At(n){return(n==null?void 0:n.component)&&Qe.includes(n.component)}function vt(A){return x(this,arguments,function*({getSchema:n,getProps:r,formElRef:s,isInitedDefault:o}){He(()=>x(this,null,function*(){if(t(o)||!t(r).autoFocusFirstItem)return;yield Ae();const l=t(n),p=t(s),w=p==null?void 0:p.$el;if(!p||!w||!l||l.length===0)return;const c=l[0];if(!c.component||!c.component.includes("Input"))return;const h=w.querySelector(".ant-row:first-child input");h&&(h==null||h.focus())}))})}const Dt=Ke({name:"BasicForm",__name:"BasicForm",props:Je,emits:["advanced-change","reset","submit","register","field-value-change"],setup(n,{expose:r,emit:s}){const o=n,A=Ue(),l=Ie({}),p=rt(),w=Ie({isAdvanced:!0,hideAdvanceBtn:!1,isLoad:!1,actionSpan:6}),c=z({}),h=z(!1),F=z(),D=z(null),B=z(null),{prefixCls:u}=tt("basic-form"),d=X(()=>L(L({},o),t(F))),E=X(()=>[u,{[`${u}--compact`]:t(d).compact}]),y=X(()=>{const{baseRowStyle:f={},rowProps:_}=t(d);return L({style:f},_)}),b=X(()=>L(L(L({},A),o),t(d))),j=X(()=>{var _;const f=t(D)||t(d).schemas;for(const V of f){const{defaultValue:k,component:ne,componentProps:se={},isHandleDateDefaultValue:Pe=!0}=V;if(Pe&&k&&ne&&je.includes(ne)){const $e={schema:V,tableAction:(_=o.tableAction)!=null?_:{},formModel:l,formActionType:{}},ae=se?typeof se=="function"?se($e).valueFormat:se.valueFormat:null;if(!Array.isArray(k))V.defaultValue=ae?H(k).format(ae):H(k);else{const ve=[];k.forEach(ge=>{ve.push(ae?H(ge).format(ae):H(ge))}),V.defaultValue=ve}}}return t(d).showAdvancedButton?G(f.filter(V=>!re(V.component))):G(f)}),{handleToggleAdvanced:P,fieldsIsAdvancedMap:C}=ut({advanceState:w,emit:s,getProps:d,getSchema:j,formModel:l,defaultValueRef:c}),{handleFormValues:$,initDefault:N}=ft({getProps:d,defaultValueRef:c,getSchema:j,formModel:l});vt({getSchema:j,getProps:d,isInitedDefault:h,formElRef:B});const{handleSubmit:S,setFieldsValue:K,clearValidate:J,validate:e,validateFields:a,getFieldsValue:v,updateSchema:i,resetSchema:g,appendSchemaByField:m,removeSchemaByField:O,resetFields:I,scrollToField:fe}=ht({emit:s,getProps:d,formModel:l,getSchema:j,defaultValueRef:c,formElRef:B,schemaRef:D,handleFormValues:$});ze({resetAction:I,submitAction:S}),Z(()=>t(d).model,()=>{const{model:f}=t(d);f&&K(f)},{immediate:!0}),Z(()=>o.schemas,f=>{g(f!=null?f:[])}),Z(()=>j.value,f=>{Ae(()=>{var _;(_=p==null?void 0:p.redoModalHeight)==null||_.call(p)}),!t(h)&&f!=null&&f.length&&(N(),h.value=!0)}),Z(()=>l,_e(()=>{t(d).submitOnChange&&S()},300),{deep:!0});function ee(f){return x(this,null,function*(){F.value=Le(t(F)||{},f)})}function R(f,_,V){l[f]=_,s("field-value-change",f,_),V&&V.itemProps&&!V.itemProps.autoLink&&a([f]).catch(k=>{})}function te(f){const{autoSubmitOnEnter:_}=t(d);if(_&&f.key==="Enter"&&f.target&&f.target instanceof HTMLElement){const V=f.target;V&&V.tagName&&V.tagName.toUpperCase()=="INPUT"&&S()}}const T={getFieldsValue:v,setFieldsValue:K,resetFields:I,updateSchema:i,resetSchema:g,setProps:ee,removeSchemaByField:O,appendSchemaByField:m,clearValidate:J,validateFields:a,validate:e,submit:S,scrollToField:fe},U=X(()=>L(L({},d.value),w));return r(L({},T)),We(()=>{N(),s("register",T)}),(f,_)=>(ue(),Ve(t(it),De(b.value,{class:E.value,ref_key:"formElRef",ref:B,model:l,onKeypress:qe(te,["enter"])}),{default:oe(()=>[Te(t(ot),pe(he(y.value)),{default:oe(()=>[ie(f.$slots,"formHeader"),(ue(!0),Ye(Xe,null,de(j.value,V=>(ue(),Ve(Ge,{key:V.field,isAdvanced:t(C)[V.field],tableAction:f.tableAction,formActionType:T,schema:V,formProps:d.value,allDefaultValues:c.value,formModel:l,setFormModel:R},Be({_:2},[de(Object.keys(f.$slots),k=>({name:k,fn:oe(ne=>[ie(f.$slots,k,pe(he(ne||{})))])}))]),1032,["isAdvanced","tableAction","schema","formProps","allDefaultValues","formModel"]))),128)),Te(Ze,De(U.value,{onToggleAdvanced:t(P)}),Be({_:2},[de(["resetBefore","submitBefore","advanceBefore","advanceAfter"],V=>({name:V,fn:oe(k=>[ie(f.$slots,V,pe(he(k||{})))])}))]),1040,["onToggleAdvanced"]),ie(f.$slots,"formFooter")]),_:3},16)]),_:3},16,["class","model","onKeypress"]))}});export{Dt as _};
