import{p as Z,f as q,aD as H}from"./entry/index-1163f12d-1703821863576.js";import{ap as y,k as K,aD as Q,aI as ee,aJ as te}from"./antd-090f1744.js";import{d as $,c as I,Z as L,_ as R,l as a,a9 as w,N as ne,F as ae,aa as oe,a8 as F,u as l,ai as se,ac as E,ad as ie,a1 as le,r as re,f as W,h as ce,E as T,I as ue,a7 as me}from"./vue-d56f5f31.js";import{P as de}from"./index-9f5f841f.js";import"./useContentViewHeight-17e909ee.js";import"./useWindowSizeFn-ab2a372a.js";import"./onMountedOrActivated-60a5193f.js";const ge=$({name:"ImagePreview",__name:"Preview",props:{functional:Z.bool,imageList:{type:Array}},setup(n){const c=n,u=y.PreviewGroup,{prefixCls:m}=q("image-preview"),t=I(()=>{const{imageList:r}=c;return r?r.map(d=>K(d)?{src:d,placeholder:!1}:d):[]});return(r,d)=>(L(),R("div",{class:le(l(m))},[a(l(u),null,{default:w(()=>[!n.imageList||r.$slots.default?ne(r.$slots,"default",{key:0}):(L(!0),R(ae,{key:1},oe(t.value,f=>(L(),F(l(y),se(E({key:f.src},f)),ie({_:2},[f.placeholder?{name:"placeholder",fn:w(()=>[a(l(y),E(f,{src:f.placeholder,preview:!1}),null,16,["src"])]),key:"0"}:void 0]),1040))),128))]),_:3})],2))}});const fe="/assets/resume-8f27866b.svg",ve="/assets/p-rotate-cb8bbfc3.svg",pe="/assets/scale-44abde22.svg",he="/assets/unscale-c552f416.svg",_e="/assets/unrotate-ef6a2daf.svg";var v=function(n){return n[n.LOADING=0]="LOADING",n[n.DONE=1]="DONE",n[n.FAIL=2]="FAIL",n}(v||{});const Ie={show:{type:Boolean,default:!1},imageList:{type:Array,default:null},index:{type:Number,default:0},scaleStep:{type:Number},defaultWidth:{type:Number},maskClosable:{type:Boolean},rememberState:{type:Boolean}},s="img-preview",Le=$({name:"ImagePreview",props:Ie,emits:["img-load","img-error"],setup(n,{expose:c,emit:u}){const m=new Map,t=re({currentUrl:"",imgScale:1,imgRotate:0,imgTop:0,imgLeft:0,status:v.LOADING,currentIndex:0,moveX:0,moveY:0,show:n.show}),r=W(null),d=W(null);function f(){G();const{index:e,imageList:o}=n;if(!o||!o.length)throw new Error("imageList is undefined");t.currentIndex=e,D(o[e])}function x(){t.imgScale=1,t.imgRotate=0,t.imgTop=0,t.imgLeft=0}function G(){const e=l(r);e&&(e.onmousewheel=S,document.body.addEventListener("DOMMouseScroll",S),document.ondragstart=function(){return!1})}const h=I(()=>{var o;const e=(o=n==null?void 0:n.scaleStep)!=null?o:0;return(e!=null?e:0>0)?e/100:t.imgScale/10});function S(e){e=e||window.event,e.delta=e.wheelDelta||-e.detail,e.preventDefault(),e.delta>0&&_(h.value),e.delta<0&&_(-h.value)}function _(e){t.imgScale<=.2&&e<0||(t.imgScale+=e*.1,t.imgScale<0&&(t.imgScale=.02))}function k(e){t.imgRotate+=e}function X(){const e=l(d);e&&(e.onmousemove=null)}function D(e){t.status=v.LOADING;const o=new Image;o.src=e,o.onload=i=>{if(t.currentUrl!==e){const g=i.composedPath();if(n.rememberState){m.set(t.currentUrl,{scale:t.imgScale,top:t.imgTop,left:t.imgLeft,rotate:t.imgRotate});const p=m.get(e);p?(t.imgScale=p.scale,t.imgTop=p.top,t.imgRotate=p.rotate,t.imgLeft=p.left):(x(),n.defaultWidth&&(t.imgScale=n.defaultWidth/g[0].naturalWidth))}else n.defaultWidth&&(t.imgScale=n.defaultWidth/g[0].naturalWidth);g&&u("img-load",{index:t.currentIndex,dom:g[0],url:e})}t.currentUrl=e,t.status=v.DONE},o.onerror=i=>{const g=i.composedPath();g&&u("img-error",{index:t.currentIndex,dom:g[0],url:e}),t.status=v.FAIL}}function N(e){e&&e.stopPropagation(),A()}function A(){t.show=!1,document.body.removeEventListener("DOMMouseScroll",S),document.ondragstart=null}function M(){x()}c({resume:M,close:A,prev:C.bind(null,"left"),next:C.bind(null,"right"),setScale:e=>{e>0&&e<=10&&(t.imgScale=e)},setRotate:e=>{t.imgRotate=e}});function C(e){const{currentIndex:o}=t,{imageList:i}=n;e==="left"&&(t.currentIndex--,o<=0&&(t.currentIndex=i.length-1)),e==="right"&&(t.currentIndex++,o>=i.length-1&&(t.currentIndex=0)),D(i[t.currentIndex])}function Y(e){e=e||window.event,t.moveX=e.clientX,t.moveY=e.clientY;const o=l(d);o&&(o.onmousemove=B)}function B(e){e=e||window.event,e.preventDefault();const o=e.clientX-t.moveX,i=e.clientY-t.moveY;t.imgLeft+=o,t.imgTop+=i,t.moveX=e.clientX,t.moveY=e.clientY}const U=I(()=>{const{imgScale:e,imgRotate:o,imgTop:i,imgLeft:g}=t;return{transform:`scale(${e}) rotate(${o}deg)`,marginTop:`${i}px`,marginLeft:`${g}px`,maxWidth:n.defaultWidth?"unset":"100%"}}),O=I(()=>{const{imageList:e}=n;return e.length>1});ce(()=>{n.show&&f(),n.imageList&&x()});const z=e=>{n.maskClosable&&e.target&&e.target.classList.contains(`${s}-content`)&&N(e)},V=()=>a("div",{class:`${s}__close`,onClick:N},[a(Q,{class:`${s}__close-icon`},null)]),j=()=>{if(!l(O))return null;const{currentIndex:e}=t,{imageList:o}=n;return a("div",{class:`${s}__index`},[e+1,T(" / "),o.length])},J=()=>a("div",{class:`${s}__controller`},[a("div",{class:`${s}__controller-item`,onClick:()=>_(-h.value)},[a("img",{src:he},null)]),a("div",{class:`${s}__controller-item`,onClick:()=>_(h.value)},[a("img",{src:pe},null)]),a("div",{class:`${s}__controller-item`,onClick:M},[a("img",{src:fe},null)]),a("div",{class:`${s}__controller-item`,onClick:()=>k(-90)},[a("img",{src:_e},null)]),a("div",{class:`${s}__controller-item`,onClick:()=>k(90)},[a("img",{src:ve},null)])]),P=e=>l(O)?a("div",{class:[`${s}__arrow`,e],onClick:()=>C(e)},[e==="left"?a(ee,null,null):a(te,null,null)]):null;return()=>t.show&&a("div",{class:s,ref:r,onMouseup:X,onClick:z},[a("div",{class:`${s}-content`},[a("img",{style:l(U),class:[`${s}-image`,t.status===v.DONE?"":"hidden"],ref:d,src:t.currentUrl,onMousedown:Y},null),V(),j(),J(),P("left"),P("right")])])}});let b=null;function we(n){var m;if(!H)return;const c={},u=document.createElement("div");return Object.assign(c,{show:!0,index:0,scaleStep:100},n),b=a(Le,c),ue(b,u),document.body.appendChild(u),(m=b.component)==null?void 0:m.exposed}const De=$({__name:"index",setup(n){const c=["https://picsum.photos/id/66/346/216","https://picsum.photos/id/67/346/216","https://picsum.photos/id/68/346/216"];function u(){we({imageList:c,defaultWidth:700,rememberState:!0,onImgLoad:({index:t,url:r,dom:d})=>{}})}return(m,t)=>{const r=me("a-button");return L(),F(l(de),{title:"图片预览示例"},{default:w(()=>[a(l(ge),{imageList:c}),a(r,{onClick:u,type:"primary"},{default:w(()=>[T("无预览图")]),_:1})]),_:1})}}});export{De as default};
